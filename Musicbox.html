<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Smooth Jazz Flow</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
    <style>
        :root {
            --bg-color: #050505;
            --glass: rgba(30, 30, 30, 0.6);
            --border: rgba(255, 255, 255, 0.1);
            --accent: #d8b4fe; /* Purple */
            --accent-glow: rgba(216, 180, 254, 0.4);
            --text: #ffffff;
            --text-dim: rgba(255, 255, 255, 0.5);
            --pad-gap: 8px;
        }

        body {
            margin: 0;
            background: radial-gradient(circle at top right, #1a103c 0%, #000000 100%);
            font-family: -apple-system, BlinkMacSystemFont, "PingFang SC", sans-serif;
            height: 100vh;
            color: var(--text);
            overflow: hidden;
            user-select: none;
            -webkit-user-select: none;
            display: flex;
            justify-content: center;
        }

        .app {
            width: 100%;
            max-width: 480px;
            height: 100%;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        /* --- Header / Controls --- */
        .controls {
            padding: 16px;
            background: rgba(0,0,0,0.2);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border);
            z-index: 10;
        }

        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }
        
        h1 { margin: 0; font-size: 20px; font-weight: 700; letter-spacing: -0.5px; 
             background: linear-gradient(to right, #fff, #c084fc); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }

        .settings-grid {
            display: grid;
            grid-template-columns: 1.2fr 1fr 1fr;
            gap: 10px;
        }

        .knob-box {
            background: var(--glass);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 8px 10px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .label { font-size: 10px; color: var(--text-dim); text-transform: uppercase; letter-spacing: 1px; margin-bottom: 4px; }
        
        select {
            background: transparent; border: none; color: white; font-size: 13px; width: 100%; outline: none;
            font-weight: 500; appearance: none;
        }

        /* Play Button */
        .play-btn {
            background: rgba(255,255,255,0.1);
            color: var(--text);
            border: 1px solid var(--border);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 600;
        }
        .play-btn.active {
            background: rgba(52, 211, 153, 0.2);
            color: #34d399;
            border-color: rgba(52, 211, 153, 0.4);
            box-shadow: 0 0 15px rgba(52, 211, 153, 0.2);
        }

        /* --- Chord Area --- */
        .grid-scroll {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
            -webkit-overflow-scrolling: touch;
        }

        .set-label {
            font-size: 12px;
            color: var(--text-dim);
            margin: 20px 0 8px 4px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .set-label::after {
            content: ''; flex: 1; height: 1px; background: var(--border);
        }

        .chord-row {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: var(--pad-gap);
            margin-bottom: var(--pad-gap);
        }

        .pad {
            aspect-ratio: 1.3;
            background: linear-gradient(145deg, rgba(255,255,255,0.08), rgba(255,255,255,0.03));
            border: 1px solid var(--border);
            border-radius: 10px;
            position: relative;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            transition: transform 0.1s, background 0.2s;
            cursor: pointer;
        }

        .pad:active, .pad.active {
            transform: scale(0.96);
            background: rgba(255,255,255,0.15);
            border-color: var(--accent);
            box-shadow: 0 0 15px var(--accent-glow);
        }

        .chord-name { font-size: 16px; font-weight: 700; color: #fff; pointer-events: none; }
        .chord-sub { font-size: 10px; color: rgba(255,255,255,0.5); margin-top: 2px; pointer-events: none; font-family: monospace; }
        
        /* Progress Bar inside pad */
        .pad-progress {
            position: absolute; bottom: 0; left: 0; height: 3px; width: 0%;
            background: var(--accent); opacity: 0.8; transition: width 0.1s;
        }

        /* Overlay */
        #start-overlay {
            position: absolute; inset: 0; background: rgba(0,0,0,0.85); z-index: 100;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            backdrop-filter: blur(10px);
        }
        .big-btn {
            padding: 18px 40px; font-size: 18px; border-radius: 40px; border: none;
            background: var(--accent); color: #000; font-weight: bold; cursor: pointer;
            box-shadow: 0 0 30px rgba(192, 132, 252, 0.4);
        }
    </style>
</head>
<body>

<div class="app">
    <div id="start-overlay">
        <button class="big-btn" onclick="initAudio()">ÁÇπÂáªËøõÂÖ•Èü≥‰πêÊµÅ</button>
        <p style="margin-top:20px; color:#666; font-size:12px;">Âª∫ËÆÆ‰Ω©Êà¥ËÄ≥Êú∫ ¬∑ Ëß£Èô§ÈùôÈü≥</p>
    </div>

    <div class="controls">
        <div class="top-bar">
            <h1>Smooth Jazz Flow</h1>
            <div style="display:flex; gap:10px; align-items:center;">
                <span class="label" style="margin:0;">BPM</span>
                <input type="range" min="70" max="110" value="85" style="width:80px;" oninput="Tone.Transport.bpm.value = this.value">
            </div>
        </div>
        
        <div class="settings-grid">
            <div class="knob-box">
                <span class="label">Èü≥Ëâ≤ (Tone)</span>
                <select id="tone-selector" onchange="changeSynth(this.value)">
                    <option value="rhodes">Tremolo EP (È¢§Èü≥ÁîµÈí¢)</option>
                    <option value="dx">80s DX Tine (ÁªèÂÖ∏)</option>
                    <option value="piano">Bright Grand (‰∫ÆÈí¢Áê¥)</option>
                    <option value="lofi">Lo-Fi Tape (Â§çÂè§Á£ÅÂ∏¶)</option>
                    <option value="dream">Dream Pad (Ê¢¶Â¢É)</option>
                </select>
            </div>
            
            <div class="knob-box">
                <span class="label">Ê∑∑Âìç (Space)</span>
                <select onchange="changeReverb(this.value)">
                    <option value="room">Ë¥¥ËÑ∏ (Room)</option>
                    <option value="hall" selected>Â§ßÂéÖ (Hall)</option>
                    <option value="cloud">‰∫ëÁ´Ø (Cloud)</option>
                    <option value="deep">Ê∑±Á©∫ (Deep)</option>
                </select>
            </div>

            <div class="play-btn" id="drum-btn" onclick="toggleDrums()">
                <div style="text-align:center;">
                    <div style="font-size:10px; opacity:0.7;">RHYTHM</div>
                    <span id="drum-status">STOP</span>
                </div>
            </div>
        </div>
         <div class="settings-grid" style="margin-top:8px;">
             <div class="knob-box" style="grid-column: span 3;">
                <span class="label">ËäÇÂ•èÈ£éÊ†º (Groove)</span>
                <select id="rhythm-select" onchange="changeRhythm(this.value)">
                    <option value="smooth">Smooth Jazz (Ride)</option>
                    <option value="lofi">Lo-Fi Chill (Lazy)</option>
                    <option value="funk">Neo Soul (Drunk)</option>
                    <option value="night">Late Night (Slow)</option>
                </select>
            </div>
         </div>
    </div>

    <div class="grid-scroll" id="grid">
        <!-- Chords will be injected here -->
    </div>
</div>

<script>
    // --- 1. Audio Engine Setup ---
    let polySynth, drumKit = {};
    let reverb, tremolo, chorus, vibrato, compressor, masterLimiter;
    let isPlaying = false;
    let currentRhythm = 'smooth';
    
    // ÂàùÂßãÂåñÊ†áÂøó
    let initialized = false;

    async function initAudio() {
        document.getElementById('start-overlay').style.opacity = 0;
        setTimeout(()=> document.getElementById('start-overlay').style.display='none', 500);
        
        await Tone.start();
        
        // --- Âª∫Á´ãÊïàÊûúÈìæ ---
        
        // 1. Âä®ÊÄÅÈôêÂà∂Âô® (Èò≤Ê≠¢ÁàÜÈü≥)
        masterLimiter = new Tone.Limiter(-2).toDestination();
        
        // 2. Ê∑∑Âìç (ÈªòËÆ§ Hall)
        reverb = new Tone.Reverb({ decay: 4, wet: 0.4 }).connect(masterLimiter);
        
        // 3. ÁâπÊÆäÊïàÊûúÂô® (Áî®‰∫éÁîµÈí¢ÂíåLOFI)
        tremolo = new Tone.Tremolo(5, 0.7).start(); // È¢§Èü≥
        chorus = new Tone.Chorus(4, 2.5, 0.5).start(); // ÂêàÂî±
        vibrato = new Tone.Vibrato(5, 0.1); // Ê®°ÊãüÁ£ÅÂ∏¶ÊäñÂä®
        compressor = new Tone.Compressor(-20, 3);

        // 4. ÂàõÂª∫ÈºìÁªÑÂêàÊàêÂô® (Á∫ØÂêàÊàêÔºå‰∏çÂä†ËΩΩÊñá‰ª∂)
        createDrumSynths();
        
        // 5. ÂàõÂª∫ÈªòËÆ§ÈîÆÁõòÈü≥Ëâ≤
        changeSynth('rhodes');

        initialized = true;
        
        // Ê∏≤ÊüìÁïåÈù¢
        renderGrid();
    }

    // --- 2. ÈîÆÁõòÈü≥Ëâ≤ËÆæËÆ° (Synthesis Design) ---
    function changeSynth(type) {
        if(polySynth) {
            polySynth.releaseAll();
            polySynth.dispose();
        }

        // ÈÄöÁî®ÂåÖÁªúËÆæÁΩÆ
        const commonFilter = new Tone.Filter(3000, "lowpass").connect(compressor);
        compressor.disconnect();
        
        // Ê†πÊçÆ‰∏çÂêåÁ±ªÂûãÈáçÁªÑÊïàÊûúÈìæ
        if (type === 'rhodes') {
            // Rhodes: FMÂêàÊàê + È¢§Èü≥ + ÂéãÁº© + Ê∑∑Âìç
            compressor.connect(tremolo);
            tremolo.connect(reverb);
            tremolo.wet.value = 0.6;
            
            polySynth = new Tone.PolySynth(Tone.FMSynth, {
                maxPolyphony: 8,
                voice: {
                    harmonicity: 1, // 1:1 ‰∫ßÁîüÁ∫ØÂáÄÁöÑÂü∫Èü≥
                    modulationIndex: 2, // Â∞ëÈáèË∞ÉÂà∂‰∫ßÁîüÁ±ª‰ºº Tine ÁöÑÂ£∞Èü≥
                    oscillator: { type: "sine" },
                    envelope: { attack: 0.005, decay: 1.5, sustain: 0.2, release: 2 },
                    modulation: { type: "triangle" },
                    modulationEnvelope: { attack: 0.005, decay: 0.5, sustain: 0.01, release: 0.5 }
                }
            }).connect(commonFilter);
            
        } else if (type === 'dx') {
            // Classic DX7: ‰∏ªË¶ÅÊòØ FM + Chorus
            compressor.connect(chorus);
            chorus.connect(reverb);
            chorus.wet.value = 0.3;

            polySynth = new Tone.PolySynth(Tone.FMSynth, {
                maxPolyphony: 8,
                voice: {
                    harmonicity: 3.0, // 3ÂÄçÈ¢ë‰∫ßÁîüÈáëÂ±ûÊÑü
                    modulationIndex: 10,
                    oscillator: { type: "sine" },
                    envelope: { attack: 0.001, decay: 2.0, sustain: 0.05, release: 1 },
                    modulation: { type: "sine" },
                    modulationEnvelope: { attack: 0.001, decay: 0.3, sustain: 0.01, release: 0.5 }
                }
            }).connect(commonFilter);

        } else if (type === 'piano') {
            // Bright Grand: FMÊ®°ÊãüÔºåharmonicity 1, Â∞ñÈîêÁöÑAttack
            compressor.connect(reverb);
            
            polySynth = new Tone.PolySynth(Tone.FMSynth, {
                maxPolyphony: 10,
                voice: {
                    harmonicity: 1, 
                    modulationIndex: 3,
                    oscillator: { type: "sine" }, // ËΩΩÊ≥¢
                    envelope: { attack: 0.002, decay: 1.0, sustain: 0.05, release: 1.5 },
                    modulation: { type: "square" }, // ÊñπÊ≥¢Ë∞ÉÂà∂Â¢ûÂä†Ê≥õÈü≥‰∫ÆÂ∫¶
                    modulationEnvelope: { attack: 0.002, decay: 0.4, sustain: 0, release: 0.2 }
                }
            }).connect(commonFilter);

        } else if (type === 'lofi') {
            // Lo-Fi: ÁÆÄÂçïÁöÑÊ≥¢ÂΩ¢ + Vibrato (Warble) + Lowpass
            compressor.connect(vibrato);
            vibrato.connect(reverb);
            commonFilter.frequency.value = 800; // Èó∑Èó∑ÁöÑÊÑüËßâ

            polySynth = new Tone.PolySynth(Tone.Synth, {
                maxPolyphony: 6,
                voice: {
                    oscillator: { type: "triangle" },
                    envelope: { attack: 0.05, decay: 0.4, sustain: 0.4, release: 1.5 }
                }
            }).connect(commonFilter);

        } else if (type === 'dream') {
            // Dream Pad: ÈïøAttack, AMÂêàÊàê
            compressor.connect(chorus);
            chorus.connect(reverb);
            chorus.wet.value = 0.8;
            reverb.wet.value = 0.6; // Êõ¥Êπø

            polySynth = new Tone.PolySynth(Tone.AMSynth, {
                maxPolyphony: 6,
                voice: {
                    harmonicity: 2.5,
                    oscillator: { type: "sine" },
                    envelope: { attack: 0.5, decay: 3, sustain: 1, release: 4 },
                    modulation: { type: "square" },
                    modulationEnvelope: { attack: 0.5, decay: 3, sustain: 0.5, release: 4 }
                }
            }).connect(commonFilter);
        }
        
        polySynth.volume.value = -6;
    }

    function changeReverb(type) {
        // ÈáçÁΩÆ reverb
        if(reverb) {
            if (type === 'room') { reverb.decay = 1.5; reverb.wet.value = 0.2; }
            if (type === 'hall') { reverb.decay = 4.0; reverb.wet.value = 0.4; }
            if (type === 'cloud') { reverb.decay = 8.0; reverb.wet.value = 0.6; }
            if (type === 'deep') { reverb.decay = 15.0; reverb.wet.value = 0.8; }
        }
    }

    // --- 3. ÈºìÊú∫ËÆæËÆ° (Advanced Synth Drums) ---
    function createDrumSynths() {
        const drumLimit = new Tone.Limiter(-1).connect(masterLimiter);
        
        // Kick: Êõ¥Âä†ÂéöÈáç
        const kick = new Tone.MembraneSynth({
            pitchDecay: 0.05, octaves: 6, oscillator: { type: "sine" },
            envelope: { attack: 0.001, decay: 0.4, sustain: 0.01, release: 1.4 }
        }).connect(drumLimit);
        
        // Snare: ÈíàÂØπ‰∏çÂêåÈ£éÊ†ºÂèØË∞ÉÔºåËøôÈáåÂÅö‰∏Ä‰∏™ÈÄöÁî®ÁöÑ Crisp Snare
        const snare = new Tone.NoiseSynth({
            noise: { type: "pink" },
            envelope: { attack: 0.001, decay: 0.25, sustain: 0 }
        }).connect(new Tone.Filter(1200, "highpass")).connect(drumLimit);
        
        // HiHat: ÈáëÂ±ûÊÑü
        const hat = new Tone.MetalSynth({
            frequency: 250, envelope: { attack: 0.001, decay: 0.05, release: 0.01 },
            harmonicity: 4.1, modulationIndex: 40, resonance: 3000, octaves: 1
        }).connect(drumLimit);
        hat.volume.value = -10;

        // Shaker (for Lofi)
        const shaker = new Tone.NoiseSynth({
            noise: { type: "white" },
            envelope: { attack: 0.05, decay: 0.1, sustain: 0 }
        }).connect(new Tone.Filter(3000, "bandpass")).connect(drumLimit);
        shaker.volume.value = -12;

        drumKit = { kick, snare, hat, shaker };
    }

    // --- 4. ËäÇÂ•èÂèëÁîüÂô® (Sequencer) ---
    function toggleDrums() {
        if (!initialized) return;
        const btn = document.getElementById('drum-btn');
        const status = document.getElementById('drum-status');
        
        isPlaying = !isPlaying;
        
        if(isPlaying) {
            Tone.Transport.start();
            btn.classList.add('active');
            status.innerText = "PLAYING";
            playGroove();
        } else {
            Tone.Transport.stop();
            Tone.Transport.cancel();
            btn.classList.remove('active');
            status.innerText = "STOP";
        }
    }
    
    function changeRhythm(val) {
        currentRhythm = val;
        if(isPlaying) playGroove();
    }

    function playGroove() {
        Tone.Transport.cancel();
        const { kick, snare, hat, shaker } = drumKit;

        if (currentRhythm === 'smooth') {
            Tone.Transport.bpm.value = 90;
            Tone.Transport.swing = 0.5; // Swing feel
            
            // Jazz Ride style on HiHat
            new Tone.Sequence((time, note) => {
                if(note === 1) hat.triggerAttackRelease("32n", time, 0.6); // Ding
                if(note === 2) hat.triggerAttackRelease("32n", time, 0.4); // da
                if(note === 3) hat.triggerAttackRelease("32n", time, 0.5); // Ding
            }, [1, 0, 2, 3, 1, 0, 2, 3], "8n").start(0);

            // Soft Kick & Snare
            new Tone.Sequence((time, note) => {
                if(note==='K') kick.triggerAttackRelease("C1", "8n", time, 0.8);
                if(note==='S') snare.triggerAttackRelease("16n", time, 0.6);
            }, ['K', null, 'K', null, 'S', null, null, null], "4n").start(0);

        } else if (currentRhythm === 'lofi') {
            Tone.Transport.bpm.value = 75;
            Tone.Transport.swing = 0; 
            
            // Drunken / Lazy Beat (slightly delayed snare manually)
            const loop = new Tone.Loop(time => {
                kick.triggerAttackRelease("C1", "8n", time, 1);
                // Snare slightly late
                snare.triggerAttackRelease("8n", time + Tone.Time("4n").toSeconds() + 0.02, 0.8);
                kick.triggerAttackRelease("C1", "8n", time + Tone.Time("4n").toSeconds()*2 + Tone.Time("16n").toSeconds());
                snare.triggerAttackRelease("8n", time + Tone.Time("4n").toSeconds()*3 + 0.01, 0.8);
                
                // Constant Shaker
                shaker.triggerAttackRelease("16n", time, 0.3);
                shaker.triggerAttackRelease("16n", time + Tone.Time("8n").toSeconds(), 0.4);
                shaker.triggerAttackRelease("16n", time + Tone.Time("4n").toSeconds(), 0.3);
            }, "1m").start(0);

        } else if (currentRhythm === 'funk') {
            Tone.Transport.bpm.value = 88;
            Tone.Transport.swing = 0.2;
            
            new Tone.Sequence((time, col) => {
                if(col === 'x') hat.triggerAttackRelease("32n", time, 0.7);
            }, ['x','x','x','x', 'x','x','x','x'], "16n").start(0);
            
            new Tone.Sequence((time, col) => {
                if(col==='K') kick.triggerAttackRelease("C1", "16n", time, 1);
                if(col==='S') snare.triggerAttackRelease("16n", time, 0.9);
            }, ['K', null, 'S', null, null, 'K', 'S', null], "8n").start(0);
        } else if (currentRhythm === 'night') {
             Tone.Transport.bpm.value = 65;
             Tone.Transport.swing = 0.5;
             
             // Very sparse
             new Tone.Loop(time => {
                kick.triggerAttackRelease("C1", "8n", time, 0.7);
                snare.triggerAttackRelease("16n", time + Tone.Time("2n").toSeconds(), 0.5); // Rimshot feel
                hat.triggerAttackRelease("32n", time, 0.3);
                hat.triggerAttackRelease("32n", time + Tone.Time("4n").toSeconds(), 0.2);
                hat.triggerAttackRelease("32n", time + Tone.Time("2n").toSeconds(), 0.3);
                hat.triggerAttackRelease("32n", time + Tone.Time("2n").toSeconds() + Tone.Time("4n").toSeconds(), 0.2);
             }, "1m").start(0);
        }
    }

    // --- 5. ÂíåÂº¶ÊéíÂàó (Progression Sets) ---
    // ÊØè‰∏ÄË°åÊòØ‰∏Ä‰∏™ SetÔºåËÆæËÆ°‰∏∫ÂèØ‰ª•Âæ™ÁéØÊí≠Êîæ
    const progressionSets = [
        {
            name: "Neo Soul C Minor (Smooth)",
            chords: [
                { n: "AbMaj7", s: "VI Major", notes: ["Ab3", "C4", "Eb4", "G4"], c: "#f472b6" },
                { n: "G7alt", s: "V Altered", notes: ["G3", "B3", "Eb4", "F4", "Bb4"], c: "#fb923c" },
                { n: "Cm9", s: "i Minor", notes: ["C3", "Eb3", "G3", "Bb3", "D4"], c: "#818cf8" },
                { n: "Gm7", s: "v Minor", notes: ["G3", "Bb3", "D4", "F4"], c: "#60a5fa" }
            ]
        },
        {
            name: "Sunny Side (Eb Major)",
            chords: [
                { n: "Fm9", s: "ii Minor", notes: ["F3", "Ab3", "C4", "Eb4", "G4"], c: "#60a5fa" },
                { n: "Bb13", s: "V Dominant", notes: ["Bb2", "Ab3", "C4", "D4", "G4"], c: "#fb923c" },
                { n: "EbMaj9", s: "I Major", notes: ["Eb3", "G3", "Bb3", "D4", "F4"], c: "#f472b6" },
                { n: "C7b9", s: "VI Alt", notes: ["C3", "E3", "G3", "Bb3", "Db4"], c: "#ef4444" }
            ]
        },
        {
            name: "Night Drive (Bb Lydian)",
            chords: [
                { n: "BbMaj7", s: "I Major", notes: ["Bb3", "D4", "F4", "A4"], c: "#f472b6" },
                { n: "C/Bb", s: "Lydian", notes: ["Bb2", "C4", "E4", "G4"], c: "#a78bfa" },
                { n: "Am7", s: "vii Minor", notes: ["A3", "C4", "E4", "G4"], c: "#60a5fa" },
                { n: "D7#9", s: "III Alt", notes: ["D3", "F#3", "C4", "F4"], c: "#ef4444" }
            ]
        },
        {
            name: "Lo-Fi Melancholy (F Minor)",
            chords: [
                { n: "DbMaj9", s: "VI Major", notes: ["Db3", "F3", "Ab3", "C4", "Eb4"], c: "#f472b6" },
                { n: "Cm11", s: "v Minor", notes: ["C3", "Eb3", "G3", "Bb3", "F4"], c: "#818cf8" },
                { n: "Bbm9", s: "iv Minor", notes: ["Bb2", "Db3", "F3", "Ab3", "C4"], c: "#60a5fa" },
                { n: "Eb13", s: "VII Dom", notes: ["Eb3", "G3", "Db4", "F4", "C5"], c: "#fb923c" }
            ]
        },
        {
            name: "Spicy Turnaround (Advanced)",
            chords: [
                { n: "Em11", s: "ii", notes: ["E3", "G3", "A3", "B3", "D4"], c: "#60a5fa" },
                { n: "A13b9", s: "V", notes: ["A2", "G3", "C#4", "F#4", "Bb4"], c: "#ef4444" },
                { n: "DMaj9", s: "I", notes: ["D3", "F#3", "A3", "C#4", "E4"], c: "#f472b6" },
                { n: "B7#5", s: "VI", notes: ["B2", "D#3", "G3", "A3"], c: "#fb923c" }
            ]
        },
        {
            name: "Floating (Quartal Voicings)",
            chords: [
                { n: "So What", s: "Dm11", notes: ["D3", "G3", "C4", "F4", "A4"], c: "#34d399" },
                { n: "Eb6/9", s: "Cluster", notes: ["Eb3", "G3", "C4", "F4", "Bb4"], c: "#34d399" },
                { n: "AbMaj", s: "Open", notes: ["Ab2", "Eb3", "G3", "C4"], c: "#34d399" },
                { n: "GbLyd", s: "Space", notes: ["Gb2", "Db3", "F3", "Bb3", "C4"], c: "#34d399" }
            ]
        }
    ];

    function renderGrid() {
        const grid = document.getElementById('grid');
        grid.innerHTML = ""; // Clear

        progressionSets.forEach(set => {
            // Label
            const label = document.createElement('div');
            label.className = "set-label";
            label.innerHTML = `<span>üéµ ${set.name}</span>`;
            grid.appendChild(label);

            // Row
            const row = document.createElement('div');
            row.className = "chord-row";

            set.chords.forEach(chord => {
                const pad = document.createElement('div');
                pad.className = "pad";
                pad.style.setProperty('--accent', chord.c);
                pad.innerHTML = `
                    <div class="chord-name">${chord.n}</div>
                    <div class="chord-sub">${chord.s}</div>
                    <div class="pad-progress"></div>
                `;

                // Interaction
                const trigger = (e) => {
                    if(e) e.preventDefault();
                    if(!initialized) return;
                    
                    // Visual
                    pad.classList.add('active');
                    
                    // Audio
                    // Strum effect: slightly offset notes
                    const now = Tone.now();
                    chord.notes.forEach((n, i) => {
                        polySynth.triggerAttack(n, now + i*0.01);
                    });
                };

                const release = (e) => {
                    if(e) e.preventDefault();
                    pad.classList.remove('active');
                    polySynth.triggerRelease(chord.notes);
                };

                pad.addEventListener('mousedown', trigger);
                pad.addEventListener('mouseup', release);
                pad.addEventListener('mouseleave', release);
                pad.addEventListener('touchstart', trigger);
                pad.addEventListener('touchend', release);

                row.appendChild(pad);
            });
            grid.appendChild(row);
        });
        
        // Add footer space
        const footer = document.createElement('div');
        footer.style.height = "50px";
        grid.appendChild(footer);
    }
</script>
</body>
</html>